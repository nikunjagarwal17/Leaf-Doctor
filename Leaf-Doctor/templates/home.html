{% extends 'base.html' %}
{% block pagetitle %}AI Plant Disease Diagnosis{% endblock pagetitle %}
{% block body %}

<!-- Hero Section -->
<section class="hero-section">
    <div class="hero-content">
        <div class="hero-text">
            <div class="hero-badge">
                <i data-lucide="sparkles"></i>
                <span>Agentic AI Powered</span>
            </div>
            <h1 class="hero-title">
                Diagnose Plant Diseases
                <span class="gradient-text">Instantly with AI</span>
            </h1>
            <p class="hero-description">
                Upload leaf photos and get instant disease diagnosis powered by our ensemble CNN model. 
                Ask follow-up questions grounded in our embedded knowledge base with Groq LLM.
            </p>
            <div class="hero-features">
                <div class="feature-chip">
                    <i data-lucide="layers"></i>
                    <span>Multi-image Ensemble</span>
                </div>
                <div class="feature-chip">
                    <i data-lucide="brain"></i>
                    <span>39 Disease Classes</span>
                </div>
                <div class="feature-chip">
                    <i data-lucide="message-circle"></i>
                    <span>Agentic Chat</span>
                </div>
            </div>
        </div>
        <div class="hero-upload-card" id="dropZone">
            <div class="upload-card-glow"></div>
            <div class="upload-card-content">
                <div class="upload-icon-wrapper">
                    <div class="upload-icon-pulse"></div>
                    <i data-lucide="image-plus" class="upload-icon"></i>
                </div>
                <h3>Drop leaf images here</h3>
                <p>or click to browse</p>
                <p class="upload-hint">Up to 4 images • JPG, PNG • Max 10MB each</p>
                <button class="btn btn-primary btn-lg" id="chooseImagesBtn" type="button">
                    <i data-lucide="upload"></i>
                    <span>Choose Images</span>
                </button>
            </div>
            <input type="file" name="images" id="imageInput" accept="image/*" hidden multiple />
        </div>
    </div>
</section>

<!-- Main Chat Interface -->
<section class="chat-section">
    <div class="chat-container">
        <!-- Chat Panel -->
        <div class="chat-panel glass-card">
            <!-- Chat Header -->
            <header class="chat-header">
                <div class="chat-header-info">
                    <div class="chat-avatar">
                        <i data-lucide="bot"></i>
                    </div>
                    <div>
                        <h2>Plant Care Assistant</h2>
                        <div class="status-indicators">
                            <span class="status-badge status-online">
                                <span class="status-dot"></span>
                                CNN Ready
                            </span>
                            <span class="status-badge">
                                <i data-lucide="database" style="width: 12px; height: 12px;"></i>
                                Embeddings Loaded
                            </span>
                            <span class="status-badge">
                                <i data-lucide="zap" style="width: 12px; height: 12px;"></i>
                                Groq LLM
                            </span>
                        </div>
                    </div>
                </div>
                <button class="btn btn-ghost btn-icon" id="clearChatBtn" title="Clear chat">
                    <i data-lucide="trash-2"></i>
                </button>
            </header>
            
            <!-- Chat Messages Stream -->
            <div class="chat-stream" id="chatStream" aria-live="polite">
                <!-- Messages will be injected here -->
            </div>
            
            <!-- Composer Card -->
            <div class="composer-card">
                <!-- Image Preview Row -->
                <div class="image-preview-section">
                    <div class="preview-header">
                        <div class="preview-info">
                            <i data-lucide="images"></i>
                            <span>Selected Images</span>
                            <span class="image-count" id="imageCount">0</span>
                        </div>
                        <div class="preview-actions">
                            <button type="button" class="btn btn-secondary btn-sm" id="addImagesBtn">
                                <i data-lucide="plus"></i>
                                Add More
                            </button>
                            <button type="button" class="btn btn-primary btn-sm" id="predictBtn" disabled>
                                <i data-lucide="scan"></i>
                                Run Diagnosis
                            </button>
                        </div>
                    </div>
                    <div class="thumb-grid" id="thumbList">
                        <div class="empty-state">
                            <i data-lucide="image-off"></i>
                            <span>No images selected</span>
                        </div>
                    </div>
                </div>
                
                <!-- Note Input -->
                <div class="note-section">
                    <label for="noteField" class="input-label">
                        <i data-lucide="file-text"></i>
                        Additional Notes <span class="optional">(optional)</span>
                    </label>
                    <textarea
                        id="noteField"
                        name="note"
                        rows="2"
                        placeholder="e.g., Yellow spots on underside, humid greenhouse, early fruiting stage..."
                        class="input-textarea"
                    ></textarea>
                </div>
                
                <!-- Advisor Panel (appears after diagnosis) -->
                <div id="advisorPanel" class="advisor-panel hidden">
                    <div class="advisor-divider">
                        <span>Ask About This Disease</span>
                    </div>
                    
                    <div class="prompt-input-group">
                        <textarea
                            id="promptField"
                            name="prompt"
                            rows="2"
                            placeholder="Ask for treatments, prevention tips, or organic solutions..."
                            class="input-textarea"
                        ></textarea>
                        <div class="prompt-actions">
                            <div class="prompt-toggles">
                                <label class="toggle-label">
                                    <input type="checkbox" id="thinkingToggle" checked />
                                    <span class="toggle-switch"></span>
                                    <span>Show Reasoning</span>
                                </label>
                                <label class="toggle-label">
                                    <input type="checkbox" id="speakToggle" />
                                    <span class="toggle-switch"></span>
                                    <span>Read Aloud</span>
                                </label>
                            </div>
                            <div class="prompt-buttons">
                                <button type="button" class="btn btn-ghost btn-icon" id="voiceBtn" title="Voice input">
                                    <i data-lucide="mic"></i>
                                </button>
                                <button type="button" class="btn btn-primary" id="sendBtn">
                                    <i data-lucide="send"></i>
                                    <span>Send</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <p class="advisor-hint">
                        <i data-lucide="info"></i>
                        Responses are grounded in our embedded disease knowledge base
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Sidebar -->
        <aside class="sidebar glass-card">
            <div class="sidebar-section">
                <h3>
                    <i data-lucide="zap"></i>
                    Quick Tips
                </h3>
                <ul class="tips-list">
                    <li>
                        <i data-lucide="check-circle"></i>
                        <span>Use multiple angles for better accuracy</span>
                    </li>
                    <li>
                        <i data-lucide="check-circle"></i>
                        <span>Clear, well-lit photos work best</span>
                    </li>
                    <li>
                        <i data-lucide="check-circle"></i>
                        <span>Include notes about symptoms for refined context</span>
                    </li>
                    <li>
                        <i data-lucide="check-circle"></i>
                        <span>Ask follow-up questions for treatment plans</span>
                    </li>
                </ul>
            </div>
            
            <div class="sidebar-section">
                <h3>
                    <i data-lucide="git-branch"></i>
                    How It Works
                </h3>
                <ol class="workflow-list">
                    <li>
                        <div class="workflow-step">1</div>
                        <div>
                            <strong>Upload</strong>
                            <span>Add up to 4 leaf photos</span>
                        </div>
                    </li>
                    <li>
                        <div class="workflow-step">2</div>
                        <div>
                            <strong>Analyze</strong>
                            <span>CNN ensemble predicts disease</span>
                        </div>
                    </li>
                    <li>
                        <div class="workflow-step">3</div>
                        <div>
                            <strong>Consult</strong>
                            <span>Ask questions, get expert advice</span>
                        </div>
                    </li>
                </ol>
            </div>
            
            <div class="sidebar-card">
                <div class="sidebar-card-icon">
                    <i data-lucide="sparkles"></i>
                </div>
                <h4>Agentic System</h4>
                <p>
                    Our AI agent autonomously plans diagnosis steps, 
                    self-corrects on low confidence, and retrieves 
                    relevant knowledge for accurate advice.
                </p>
            </div>
        </aside>
    </div>
</section>

{% endblock body %}
